'use client'

import { useState, useEffect, useRef } from 'react'
import Image from 'next/image'

interface Message {
  id: string
  text: string
  sender: 'user' | 'bot'
  timestamp: Date
}

interface Intent {
  keywords: string[]
  synonyms: string[]
  response: string | string[] | ((context?: string[], userName?: string) => string)
  category: string
  followUp?: string[] // –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
}

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å —É–º–Ω—ã–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –Ω–∞–º–µ—Ä–µ–Ω–∏–π
const INTENTS: Intent[] = [
  {
    keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', 'hi', 'hello', 'hey'],
    synonyms: ['–ø—Ä–∏–≤–µ—Ç–∏–∫', '–∑–¥–∞—Ä–æ–≤–∞', '—Å–∞–ª—é—Ç', '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é'],
    response: () => {
      const greetings = [
        '–ü—Ä–∏–≤–µ—Ç! üëã –Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
        '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π! –Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –∑–∞—à–µ–ª. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        '–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –∑–∞–≥–ª—è–Ω—É–ª. –û —á–µ–º —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?',
        '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?',
      ]
      return greetings[Math.floor(Math.random() * greetings.length)]
    },
    category: 'greeting',
    followUp: ['–ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?', '–û —á–µ–º —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?', '–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'],
  },
  {
    keywords: ['–∫–∞–∫ –¥–µ–ª–∞', '–∫–∞–∫ –ø–æ–∂–∏–≤–∞–µ—à—å', '—á—Ç–æ –Ω–æ–≤–æ–≥–æ', '–∫–∞–∫ –∂–∏–∑–Ω—å'],
    synonyms: ['–∫–∞–∫ –æ–Ω–æ', '–∫–∞–∫ —Å–∞–º', '–∫–∞–∫ —É—Å–ø–µ—Ö–∏'],
    response: () => {
      const responses = [
        '–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ! –°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏. –ê —É —Ç–µ–±—è –∫–∞–∫ –¥–µ–ª–∞?',
        '–í—Å—ë —Å—É–ø–µ—Ä! –°–µ—Ä–≥–µ–π –Ω–µ–¥–∞–≤–Ω–æ –∑–∞–∫–æ–Ω—á–∏–ª –∫–ª–∞—Å—Å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js. –ê —Ç—ã —á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?',
        '–•–æ—Ä–æ—à–æ! –°–µ—Ä–≥–µ–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏–∑—É—á–∞–µ—Ç, —Å–µ–π—á–∞—Å —É–≥–ª—É–±–ª—è–µ—Ç—Å—è –≤ React 19. –ê —É —Ç–µ–±—è –∫–∞–∫?',
        '–ù–æ—Ä–º–∞–ª—å–Ω–æ! –†–∞–±–æ—Ç–∞ –∫–∏–ø–∏—Ç, –ø—Ä–æ–µ–∫—Ç—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ. –ê —Ç—ã –∫–∞–∫? –ß–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'greeting',
  },
  {
    keywords: ['–ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ', '–ø—Ä–æ–µ–∫—Ç—ã', '—Ä–∞–±–æ—Ç—ã', '–∫–µ–π—Å—ã'],
    synonyms: ['—á—Ç–æ –¥–µ–ª–∞–ª', '–ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç', '–º–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã', '—á—Ç–æ —Å–æ–∑–¥–∞–ª', '—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã'],
    response: () => {
      const responses = [
        '–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –£ –°–µ—Ä–≥–µ—è –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã - –æ—Ç –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, Next.js –ø—Ä–æ–µ–∫—Ç—ã –∏–ª–∏ fullstack —Ä–µ—à–µ–Ω–∏—è.',
        '–ö–æ–Ω–µ—á–Ω–æ! –°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–ª –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ - –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ React/Next.js, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∞–π—Ç—ã, fullstack –ø—Ä–æ–µ–∫—Ç—ã —Å Node.js. –ï—Å—Ç—å —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, —á—Ç–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?',
        '–î–∞, –µ—Å—Ç—å —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å! –î–µ–ª–∞–ª –∏ SPA –Ω–∞ React, –∏ SSR –Ω–∞ Next.js, –∏ –±—ç–∫–µ–Ω–¥—ã –Ω–∞ Node.js. –ö–∞–∫–∞—è —Ç–µ–º–∞ —Ç–µ–±–µ –±–ª–∏–∂–µ?',
        '–£ –°–µ—Ä–≥–µ—è –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –¥–æ–≤–æ–ª—å–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ - –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ –¥–æ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'portfolio',
    followUp: ['–ö–∞–∫–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?', '–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç?', '–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?'],
  },
  {
    keywords: ['—É—Å–ª—É–≥–∏', '—á—Ç–æ –¥–µ–ª–∞–µ—à—å', '—á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è', '—á—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å'],
    synonyms: ['—á—Ç–æ —É–º–µ–µ—à—å', '–∫–∞–∫–∏–µ —É—Å–ª—É–≥–∏', '—á—Ç–æ –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å', '—á–µ–º –ø–æ–º–æ—á—å'],
    response: () => {
      const responses = [
        '–°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π - –¥–µ–ª–∞–µ—Ç —Å–∞–π—Ç—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. Frontend –Ω–∞ React/Next.js, –±—ç–∫–µ–Ω–¥ –Ω–∞ Node.js, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –ï—Å—Ç—å –∫–∞–∫–æ–π-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –≤ –ø–ª–∞–Ω–∞—Ö?',
        '–°–µ—Ä–≥–µ–π –¥–µ–ª–∞–µ—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –∫–ª—é—á - –æ—Ç –¥–∏–∑–∞–π–Ω–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞. React, Next.js, Node.js - —ç—Ç–æ –µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        '–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –°–µ—Ä–≥–µ—è. Frontend, backend, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - –≤—Å—ë —ç—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç. –ï—Å—Ç—å –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å?',
        '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç fullstack - –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –∏ –±—ç–∫–µ–Ω–¥. React, Next.js –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞, Node.js –¥–ª—è –±—ç–∫–∞. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'services',
    followUp: ['–ï—Å—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ –ø–ª–∞–Ω–∞—Ö?', '–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?', '–ú–æ–≥—É –ø–æ–º–æ—á—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.'],
  },
  {
    keywords: ['—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Ü–µ–Ω–∞', '—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç', '–ø—Ä–∞–π—Å', '—Ç–∞—Ä–∏—Ñ—ã'],
    synonyms: ['—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç', '–∫–∞–∫–∞—è —Ü–µ–Ω–∞', '—Å–∫–æ–ª—å–∫–æ –±–µ—Ä—ë—à—å', '—Ä–∞—Å—Ü–µ–Ω–∫–∏', '—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã'],
    response: () => {
      const responses = [
        '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ - —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –æ–±—ä–µ–º–∞, —Å—Ä–æ–∫–æ–≤. –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega - —Ç–∞–º –°–µ—Ä–≥–µ–π –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏—Ç –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç —Ä–∞—Å—á–µ—Ç.',
        '–¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å. –õ–µ–Ω–¥–∏–Ω–≥ - –æ–¥–Ω–æ, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –¥—Ä—É–≥–æ–µ. –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega, –∏ –°–µ—Ä–≥–µ–π —Å–∫–∞–∂–µ—Ç —Ç–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.',
        '–°–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞. –ú–æ–≥—É –¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega. –¢–∞–º –°–µ—Ä–≥–µ–π –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏—Ç.',
        '–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ–Ω–µ—á–Ω–æ. –ï—Å–ª–∏ —Ä–∞—Å—Å–∫–∞–∂–µ—à—å, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —Å–º–æ–≥—É –¥–∞—Ç—å –æ—Ü–µ–Ω–∫—É. –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega - —Ç–∞–º —É–¥–æ–±–Ω–µ–µ –æ–±—Å—É–∂–¥–∞—Ç—å —Ç–∞–∫–∏–µ –≤–µ—â–∏.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'pricing',
    followUp: ['–ö–∞–∫–æ–π –ø—Ä–æ–µ–∫—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—à—å?', '–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?', '–ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram.'],
  },
  {
    keywords: ['–∫–æ–Ω—Ç–∞–∫—Ç—ã', '–∫–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è', '—Ç–µ–ª–µ—Ñ–æ–Ω', 'email', 'telegram'],
    synonyms: ['—Å–≤—è–∑–∞—Ç—å—Å—è', '–Ω–∞–ø–∏—Å–∞—Ç—å', '—Å–≤—è–∑—å', '–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'],
    response: () => {
      const responses = [
        '–ö–æ–Ω–µ—á–Ω–æ! Telegram –°–µ—Ä–≥–µ—è: @kosmosega - —Ç–∞–º –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ. –¢–∞–∫–∂–µ –µ—Å—Ç—å email: kibalnikserg@yandex.ru –∏ —Ç–µ–ª–µ—Ñ–æ–Ω: +7 (985) 268-97-87. –ù–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤ Telegram - —Ç–∞–º –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏! üòä',
        '–î–∞, –∫–æ–Ω–µ—á–Ω–æ! Telegram: @kosmosega - —ç—Ç–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∞—Ç—å—Å—è —Å –°–µ—Ä–≥–µ–µ–º. –ï—â–µ –µ—Å—Ç—å email: kibalnikserg@yandex.ru –∏ —Ç–µ–ª–µ—Ñ–æ–Ω: +7 (985) 268-97-87. –ù–æ –≤ Telegram –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–µ–µ –≤—Å–µ–≥–æ.',
        'Telegram –°–µ—Ä–≥–µ—è: @kosmosega - —Ç–∞–º –æ–Ω –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ. –¢–∞–∫–∂–µ email: kibalnikserg@yandex.ru, —Ç–µ–ª–µ—Ñ–æ–Ω: +7 (985) 268-97-87. –ù–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç Telegram –¥–ª—è –æ–±—â–µ–Ω–∏—è.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'contacts',
  },
  {
    keywords: ['–Ω–∞–≤—ã–∫–∏', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '—Å—Ç–µ–∫', '—á—Ç–æ –∑–Ω–∞–µ—à—å', '—á—Ç–æ —É–º–µ–µ—à—å'],
    synonyms: ['–∫–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '–∫–∞–∫–æ–π —Å—Ç–µ–∫', '—á—Ç–æ –∏–∑—É—á–∞–ª', '–∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏'],
    response: () => {
      const responses = [
        '–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫ –°–µ—Ä–≥–µ—è: React, Next.js, TypeScript –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞, Node.js –¥–ª—è –±—ç–∫–∞. –†–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL, MongoDB, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Tailwind CSS. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        'React, Next.js, TypeScript - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –°–µ—Ä–≥–µ—è. –¢–∞–∫–∂–µ Node.js, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL, MongoDB), Tailwind CSS. –ï—Å—Ç—å —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, —á—Ç–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?',
        '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å React/Next.js –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ, Node.js –Ω–∞ –±—ç–∫–µ. TypeScript, Tailwind CSS, PostgreSQL, MongoDB - —ç—Ç–æ —Ç–æ, —Å —á–µ–º –æ–Ω —á–∞—â–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        '–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫ –°–µ—Ä–≥–µ—è: React, Next.js, TypeScript, Node.js. –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - PostgreSQL, MongoDB. –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è - Tailwind CSS. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'skills',
    followUp: ['–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?', '–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é?', '–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —á–µ–º—É-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É?'],
  },
  {
    keywords: ['–æ–ø—ã—Ç', '—Å—Ç–∞–∂', '—Å–∫–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞–µ—à—å', '–æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã'],
    synonyms: ['—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç', '–∫–∞–∫–æ–π –æ–ø—ã—Ç', '—Å—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã'],
    response: () => {
      const responses = [
        '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏–∑—É—á–∞–µ—Ç. –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ - –æ—Ç –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ –¥–æ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. React, Node.js - —ç—Ç–æ —Ç–æ, —Å —á–µ–º –æ–Ω —á–∞—â–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.',
        '–°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è. –†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —Ä–∞–∑–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. React, Next.js, Node.js - –µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫.',
        '–£ –°–µ—Ä–≥–µ—è –µ—Å—Ç—å –æ–ø—ã—Ç –≤ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –†–∞–±–æ—Ç–∞–ª –∏ –Ω–∞–¥ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–∞–π—Ç–∞–º–∏, –∏ –Ω–∞–¥ —Å–ª–æ–∂–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. React, Node.js - —ç—Ç–æ —Ç–æ, —á—Ç–æ –æ–Ω –∑–Ω–∞–µ—Ç —Ö–æ—Ä–æ—à–æ.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'experience',
  },
  {
    keywords: ['—Ä–∞–±–æ—Ç–∞', '–≤–∞–∫–∞–Ω—Å–∏—è', '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ', '–Ω–∞–π–º', '—Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ'],
    synonyms: ['–∏—â—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', '–Ω—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç', '–∏—â—É —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä–∞', '–Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'],
    response: () => {
      const responses = [
        '–î–∞, –°–µ—Ä–≥–µ–π –æ—Ç–∫—Ä—ã—Ç –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É! –ì–æ—Ç–æ–≤ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞ —Ñ—Ä–∏–ª–∞–Ω—Å–µ, —É–¥–∞–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ. –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ - –¥–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –≤ Telegram @kosmosega!',
        '–ö–æ–Ω–µ—á–Ω–æ! –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç –∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º. –§—Ä–∏–ª–∞–Ω—Å, —É–¥–∞–ª–µ–Ω–∫–∞, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ - –≤—Å—ë —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç. –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega, –æ–±—Å—É–¥–∏–º!',
        '–î–∞, –°–µ—Ä–≥–µ–π –≥–æ—Ç–æ–≤ –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É! –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, —Å—Ç–∞—Ä—Ç–∞–ø—ã, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ - –≤—Å—ë —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'work',
  },
  {
    keywords: ['–ø—Ä–æ–µ–∫—Ç', '–∑–∞–∫–∞–∑', '–Ω—É–∂–µ–Ω —Å–∞–π—Ç', '—Å–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç', '—Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å'],
    synonyms: ['–Ω—É–∂–µ–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', '—Å–¥–µ–ª–∞—Ç—å —Å–∞–π—Ç', '–∑–∞–∫–∞–∑–∞—Ç—å —Å–∞–π—Ç', '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞'],
    response: () => {
      const responses = [
        '–û—Ç–ª–∏—á–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ - –∫–∞–∫–æ–π —Ç–∏–ø —Å–∞–π—Ç–∞ –Ω—É–∂–µ–Ω, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å—Ç—å –ª–∏ –¥–∏–∑–∞–π–Ω, –∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏? –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ª—É—á—à–µ –≤ Telegram @kosmosega - —Ç–∞–º –°–µ—Ä–≥–µ–π –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏—Ç.',
        '–ö–æ–Ω–µ—á–Ω–æ! –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞. –ö–∞–∫–æ–π —Ç–∏–ø —Å–∞–π—Ç–∞, —Ñ—É–Ω–∫—Ü–∏–∏, –¥–∏–∑–∞–π–Ω, —Å—Ä–æ–∫–∏? –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –≤ Telegram @kosmosega.',
        '–•–æ—Ä–æ—à–æ! –î–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω—É–∂–Ω—ã –¥–µ—Ç–∞–ª–∏ - —Ç–∏–ø —Å–∞–π—Ç–∞, —Ñ—É–Ω–∫—Ü–∏–∏, –¥–∏–∑–∞–π–Ω, —Å—Ä–æ–∫–∏. –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega –∏–ª–∏ –Ω–∞ email kibalnikserg@yandex.ru, –æ–±—Å—É–¥–∏–º –≤—Å—ë –ø–æ–¥—Ä–æ–±–Ω–æ.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'project',
  },
  {
    keywords: ['react', 'node.js', 'typescript', 'next.js'],
    synonyms: ['—Ä–µ–∞–∫—Ç', '–Ω–æ–¥', '—Ç–∞–π–ø—Å–∫—Ä–∏–ø—Ç', '–Ω–µ–∫—Å—Ç'],
    response: (context) => {
      const tech = context?.[context.length - 1]?.toLowerCase() || ''
      const responses: Record<string, string> = {
        react: 'React - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –°–µ—Ä–≥–µ—è! –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —Ö—É–∫–∞–º–∏, Context API, Redux. –°–æ–∑–¥–∞–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ SPA –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Next.js –¥–ª—è SSR. –ï—Å—Ç—å –æ–ø—ã—Ç —Å React 19 –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Ñ–∏—á–∞–º–∏.',
        'node.js': 'Node.js - –°–µ—Ä–≥–µ–π –æ—Ç–ª–∏—á–Ω–æ –∑–Ω–∞–µ—Ç! –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç REST API, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Express, NestJS. –û–ø—ã—Ç —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º, WebSockets, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç TypeScript –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.',
        typescript: 'TypeScript - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö –°–µ—Ä–≥–µ—è! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã, generics, utility types. –ü–æ–º–æ–≥–∞–µ—Ç –ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥.',
        'next.js': 'Next.js - –ª—é–±–∏–º—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –°–µ—Ä–≥–µ—è! –†–∞–±–æ—Ç–∞–µ—Ç —Å App Router, Server Components, Server Actions. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, SEO, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ SSR –≥–¥–µ –Ω—É–∂–Ω–æ.',
      }
      return responses[tech] || '–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è! –°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–µ–π –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏?'
    },
    category: 'technology',
  },
  {
    keywords: ['—Å—Ä–æ–∫–∏', '–∫–æ–≥–¥–∞', '—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏', '–¥–æ–ª–≥–æ'],
    synonyms: ['–∫–∞–∫ –±—ã—Å—Ç—Ä–æ', '–≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏', '—Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è'],
    response: () => {
      const responses = [
        '–°—Ä–æ–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ–Ω–µ—á–Ω–æ. –õ–µ–Ω–¥–∏–Ω–≥ - 3-7 –¥–Ω–µ–π, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç - 1-3 –Ω–µ–¥–µ–ª–∏, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –æ—Ç –º–µ—Å—è—Ü–∞. –¢–æ—á–Ω—ã–µ —Å—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è —É–ª–æ–∂–∏—Ç—å—Å—è!',
        '–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –õ–µ–Ω–¥–∏–Ω–≥ –°–µ—Ä–≥–µ–π –¥–µ–ª–∞–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é, —Å–∞–π—Ç –ø–æ—Å–ª–æ–∂–Ω–µ–µ - 2-3 –Ω–µ–¥–µ–ª–∏, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –æ—Ç –º–µ—Å—è—Ü–∞. –¢–æ—á–Ω–µ–µ —Å–∫–∞–∂–µ—Ç –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞.',
        '–ü–æ-—Ä–∞–∑–Ω–æ–º—É, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –õ–µ–Ω–¥–∏–Ω–≥ - –±—ã—Å—Ç—Ä–æ, —Å–∞–π—Ç - –Ω–µ–¥–µ–ª–∏, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –º–µ—Å—è—Ü—ã. –ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–µ—Ä–≥–µ–π —Å–º–æ–∂–µ—Ç –Ω–∞–∑–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ —Å—Ä–æ–∫–∏.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'timeline',
  },
  {
    keywords: ['–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–≥–¥–µ —É—á–∏–ª—Å—è', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç'],
    synonyms: ['–≥–¥–µ —É—á–∏–ª—Å—è', '–∫–∞–∫–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–≥–¥–µ –ø–æ–ª—É—á–∞–ª –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ'],
    response: () => {
      const responses = [
        '–°–µ—Ä–≥–µ–π —É—á–∏–ª—Å—è –≤ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –∫–æ–ª–ª–µ–¥–∂–µ ‚Ññ 21, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ". –ù–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑—É—á–∞–µ—Ç —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.',
        '–°–µ—Ä–≥–µ–π –∑–∞–∫–æ–Ω—á–∏–ª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ ‚Ññ 21 –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. –ù–æ –≤ IT –≥–ª–∞–≤–Ω–æ–µ - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É—á–∏—Ç—å—Å—è, —Ç–∞–∫ —á—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏–∑—É—á–∞–µ—Ç.',
        '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –°–µ—Ä–≥–µ–π –ø–æ–ª—É—á–∏–ª –≤ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –∫–æ–ª–ª–µ–¥–∂–µ ‚Ññ 21. –ù–æ –≤ –Ω–∞—à–µ–π —Å—Ñ–µ—Ä–µ –≤–∞–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è, —Ç–∞–∫ —á—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'education',
  },
  {
    keywords: ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', 'thanks', 'thank you'],
    synonyms: ['–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å', '—Å–ø–∞—Å–∏–±–æ –±–æ–ª—å—à–æ–µ'],
    response: () => {
      const responses = [
        '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –†–∞–¥ –±—ã–ª –ø–æ–º–æ—á—å. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ - –ø–∏—à–∏! –ò–ª–∏ –≤ Telegram @kosmosega - —Ç–∞–º –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏.',
        '–ù–µ –∑–∞ —á—Ç–æ! –ï—Å–ª–∏ –±—É–¥—É—Ç –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã - –æ–±—Ä–∞—â–∞–π—Å—è. –í Telegram @kosmosega –°–µ—Ä–≥–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ.',
        '–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –µ—â–µ –∑–∞—Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å - –ø–∏—à–∏. –ò–ª–∏ –≤ Telegram @kosmosega - —Ç–∞–º —É–¥–æ–±–Ω–µ–µ –æ–±—â–∞—Ç—å—Å—è.',
        '–†–∞–¥ –ø–æ–º–æ—á—å! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ - –æ–±—Ä–∞—â–∞–π—Å—è. –í Telegram @kosmosega –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'gratitude',
  },
  {
    keywords: ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '—É–¥–∞—á–∏', 'bye'],
    synonyms: ['–¥–æ –≤—Å—Ç—Ä–µ—á–∏', '–≤—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ', '–¥–æ —Å–∫–æ—Ä–æ–≥–æ'],
    response: () => {
      const responses = [
        '–î–æ –≤—Å—Ç—Ä–µ—á–∏! üëã –£–¥–∞—á–∏! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è - –ø–∏—à–∏ –≤ Telegram @kosmosega.',
        '–ü–æ–∫–∞! –£–¥–∞—á–∏ –≤–æ –≤—Å–µ–º! –ï—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã - –æ–±—Ä–∞—â–∞–π—Å—è, –≤ Telegram @kosmosega –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—Ç–∏—Ç.',
        '–î–æ —Å–∫–æ—Ä–æ–≥–æ! –£–¥–∞—á–∏! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç - –ø–∏—à–∏ –≤ Telegram @kosmosega.',
        '–í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ! üëã –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å - –æ–±—Ä–∞—â–∞–π—Å—è –≤ Telegram @kosmosega.',
      ]
      return responses[Math.floor(Math.random() * responses.length)]
    },
    category: 'farewell',
  },
]

const getDefaultResponse = (): string => {
  const responses = [
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ. –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ª—É—á—à–µ –≤ Telegram @kosmosega - —Ç–∞–º –°–µ—Ä–≥–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ! üòä',
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π. –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∞—Ö, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
    '–ü–æ–Ω—è–ª —Ç–µ–±—è. –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —ç—Ç–æ –¥–µ—Ç–∞–ª—å–Ω–µ–µ! –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega - —Ç–∞–º –°–µ—Ä–≥–µ–π —Å–º–æ–∂–µ—Ç –¥–∞—Ç—å –±–æ–ª–µ–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç.',
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ª—É—á—à–µ –≤ Telegram @kosmosega. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π —Å–∞–π—Ç–æ–≤, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è–º–∏ –∏–ª–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞.',
    '–•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç, –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega. –¢–∞–º –°–µ—Ä–≥–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ –º–æ–∂–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ.',
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –°–µ—Ä–≥–µ—è, –µ–≥–æ —É—Å–ª—É–≥–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏–ª–∏ –ø–æ–º–æ—á—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º. –ß—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
    '–ü–æ–Ω—è–ª. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–±–æ—Ç–∞—Ö –°–µ—Ä–≥–µ—è, —É—Å–ª—É–≥–∞—Ö –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ò–ª–∏ –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega?',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π - –¥–µ–ª–∞–µ—Ç —Å–∞–π—Ç—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∏ –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç?',
  ]
  return responses[Math.floor(Math.random() * responses.length)]
}

export default function ChatWidget() {
  if (process.env.NEXT_PUBLIC_SHOW_CHAT_WIDGET === 'false') return null
  return <ChatWidgetInner />
}

function ChatWidgetInner() {
  const [isOpen, setIsOpen] = useState(false)
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      text: '–ü—Ä–∏–≤–µ—Ç! üëã –Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
      sender: 'bot',
      timestamp: new Date(),
    },
  ])
  const [inputValue, setInputValue] = useState('')
  const [isTyping, setIsTyping] = useState(false)
  const [conversationContext, setConversationContext] = useState<string[]>([])
  const [discussedTopics, setDiscussedTopics] = useState<Set<string>>(new Set())
  const [lastTopic, setLastTopic] = useState<string>('')
  const messagesEndRef = useRef<HTMLDivElement>(null)
  const inputRef = useRef<HTMLInputElement>(null)

  useEffect(() => {
    if (isOpen && messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' })
    }
  }, [messages, isOpen])

  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus()
    }
  }, [isOpen])

  // –£–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
  const normalizeText = (text: string): string => {
    return text
      .toLowerCase()
      .trim()
      .replace(/[^\w\s–∞-—è—ë]/gi, ' ')
      .replace(/\s+/g, ' ')
  }

  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
  const extractKeywords = (text: string): string[] => {
    const normalized = normalizeText(text)
    const words = normalized.split(' ').filter((word) => word.length > 2)
    return words
  }

  // –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
  const analyzeSentiment = (text: string): 'positive' | 'neutral' | 'negative' => {
    const positiveWords = ['–æ—Ç–ª–∏—á–Ω–æ', '—Ö–æ—Ä–æ—à–æ', '–∫–ª–∞—Å—Å–Ω–æ', '—Å—É–ø–µ—Ä', '–Ω—Ä–∞–≤–∏—Ç—Å—è', '–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ', '–∫—Ä—É—Ç–æ', '–∑–¥–æ—Ä–æ–≤–æ']
    const negativeWords = ['–ø–ª–æ—Ö–æ', '–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è', '–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ', '—Å–ª–æ–∂–Ω–æ', '–¥–æ—Ä–æ–≥–æ', '–¥–æ–ª–≥–æ']
    
    const lowerText = text.toLowerCase()
    let positiveScore = 0
    let negativeScore = 0
    
    positiveWords.forEach(word => {
      if (lowerText.includes(word)) positiveScore++
    })
    
    negativeWords.forEach(word => {
      if (lowerText.includes(word)) negativeScore++
    })
    
    if (negativeScore > positiveScore) return 'negative'
    if (positiveScore > 0) return 'positive'
    return 'neutral'
  }

  // –ü–æ–Ω–∏–º–∞–Ω–∏–µ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  const isFollowUpQuestion = (message: string, context: string[]): boolean => {
    const followUpIndicators = ['–∞', '–Ω–æ', '–∞ —á—Ç–æ', '–∞ –∫–∞–∫', '–∞ –≥–¥–µ', '–∞ –∫–æ–≥–¥–∞', '–∞ –ø–æ—á–µ–º—É', '–∞ –º–æ–∂–Ω–æ', '–∞ –µ—Å–ª–∏']
    const lowerMessage = normalizeText(message)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å —É—Ç–æ—á–Ω—è—é—â–µ–≥–æ —Å–ª–æ–≤–∞
    for (const indicator of followUpIndicators) {
      if (lowerMessage.startsWith(indicator) || lowerMessage.includes(' ' + indicator + ' ')) {
        return true
      }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    if (context.length > 0 && message.length < 30 && (message.includes('?') || message.includes('–∞'))) {
      return true
    }
    
    return false
  }

  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π/–ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
  const extractSpecificTopics = (text: string): string[] => {
    const topics: string[] = []
    const techKeywords = ['react', 'node', 'typescript', 'next', 'javascript', 'html', 'css', 'mongodb', 'postgresql', 'tailwind']
    const projectTypes = ['–ª–µ–Ω–¥–∏–Ω–≥', '—Å–∞–π—Ç', '–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', 'e-commerce', '–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π', 'spa', 'ssr']
    
    const lowerText = normalizeText(text)
    
    techKeywords.forEach(tech => {
      if (lowerText.includes(tech)) topics.push(tech)
    })
    
    projectTypes.forEach(type => {
      if (lowerText.includes(type)) topics.push(type)
    })
    
    return topics
  }

  // –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π
  const detectComparison = (text: string): { type: 'vs' | 'or' | 'and' | null, items: string[] } => {
    const lowerText = normalizeText(text)
    
    if (lowerText.includes(' –∏–ª–∏ ') || lowerText.includes(' vs ') || lowerText.includes(' –ø—Ä–æ—Ç–∏–≤ ')) {
      const parts = lowerText.split(/ –∏–ª–∏ | vs | –ø—Ä–æ—Ç–∏–≤ /)
      return { type: 'or', items: parts.map(p => p.trim()).filter(p => p.length > 0) }
    }
    
    if (lowerText.includes(' –∏ ') && lowerText.includes('?')) {
      const parts = lowerText.split(' –∏ ')
      return { type: 'and', items: parts.map(p => p.trim()).filter(p => p.length > 0) }
    }
    
    return { type: null, items: [] }
  }

  // –ü–æ–¥—Å—á–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
  const calculateRelevance = (intent: Intent, message: string, keywords: string[]): number => {
    const normalizedMessage = normalizeText(message)
    let score = 0

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    for (const keyword of intent.keywords) {
      if (normalizedMessage.includes(keyword)) {
        score += 3
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
    for (const synonym of intent.synonyms) {
      if (normalizedMessage.includes(synonym)) {
        score += 2
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    for (const keyword of keywords) {
      if (intent.keywords.some((k) => k.includes(keyword) || keyword.includes(k))) {
        score += 1
      }
      if (intent.synonyms.some((s) => s.includes(keyword) || keyword.includes(s))) {
        score += 1
      }
    }

    return score
  }

  // –£–º–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const getBotResponse = (userMessage: string): string => {
    const normalizedMessage = normalizeText(userMessage)
    const keywords = extractKeywords(userMessage)
    const sentiment = analyzeSentiment(userMessage)
    const isFollowUp = isFollowUpQuestion(userMessage, conversationContext)
    const specificTopics = extractSpecificTopics(userMessage)
    const comparison = detectComparison(userMessage)

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
    setConversationContext((prev) => {
      const newContext = [...prev, normalizedMessage]
      return newContext.slice(-5) // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
    })

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Å—É–∂–¥–µ–Ω–Ω—ã–µ —Ç–µ–º—ã
    if (specificTopics.length > 0) {
      setDiscussedTopics((prev) => {
        const newSet = new Set(prev)
        specificTopics.forEach(topic => newSet.add(topic))
        return newSet
      })
    }

    // –ï—Å–ª–∏ —ç—Ç–æ —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    if (isFollowUp && conversationContext.length > 0) {
      const lastUserMessage = conversationContext[conversationContext.length - 1]
      
      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–Ω—è—Ç—å, –æ —á–µ–º –∏–¥–µ—Ç —Ä–µ—á—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
      const contextScores = INTENTS.map((intent) => ({
        intent,
        score: calculateRelevance(intent, lastUserMessage, extractKeywords(lastUserMessage)),
      }))
      contextScores.sort((a, b) => b.score - a.score)
      
      if (contextScores[0].score > 0) {
        const contextIntent = contextScores[0].intent
        const followUpResponse = handleFollowUpQuestion(normalizedMessage, contextIntent.category)
        if (followUpResponse) {
          setLastTopic(contextIntent.category)
          return followUpResponse
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
    if (comparison.type === 'or' && comparison.items.length >= 2) {
      return handleComparison(comparison.items)
    }

    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const intentScores = INTENTS.map((intent) => {
      let score = calculateRelevance(intent, normalizedMessage, keywords)
      
      // –ë–æ–Ω—É—Å –∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
      if (lastTopic === intent.category && isFollowUp) {
        score += 2
      }
      
      // –ë–æ–Ω—É—Å –∑–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–º
      if (specificTopics.length > 0 && intent.keywords.some(k => specificTopics.some(t => k.includes(t) || t.includes(k)))) {
        score += 1.5
      }
      
      return { intent, score }
    })

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    intentScores.sort((a, b) => b.score - a.score)

    // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º score
    if (intentScores[0].score > 0) {
      const bestIntent = intentScores[0].intent
      let response: string
      
      if (typeof bestIntent.response === 'function') {
        response = bestIntent.response([...conversationContext, normalizedMessage])
      } else if (Array.isArray(bestIntent.response)) {
        response = bestIntent.response[Math.floor(Math.random() * bestIntent.response.length)]
      } else {
        response = bestIntent.response
      }

      // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
      if (sentiment === 'negative') {
        response = adaptToNegativeSentiment(response, bestIntent.category)
      } else if (sentiment === 'positive') {
        response = adaptToPositiveSentiment(response)
      }

      // –£–º–Ω—ã–µ follow-up –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      if (bestIntent.followUp && Math.random() < 0.4) {
        const contextualFollowUp = getContextualFollowUp(bestIntent.category, discussedTopics, conversationContext)
        if (contextualFollowUp) {
          response += ` ${contextualFollowUp}`
        } else {
          const followUp = bestIntent.followUp[Math.floor(Math.random() * bestIntent.followUp.length)]
          response += ` ${followUp}`
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 25%
      if (intentScores.length > 1 && intentScores[1].score > 0 && Math.random() < 0.25) {
        const secondIntent = intentScores[1].intent
        if (secondIntent.category !== bestIntent.category && !discussedTopics.has(secondIntent.category)) {
          response += ` –ú–æ–≥—É —Ç–∞–∫–∂–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ ${getCategoryHint(secondIntent.category)}. –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`
        }
      }

      // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–æ–±—Å—É–∂–¥–µ–Ω–Ω—ã—Ö —Ç–µ–º
      if (discussedTopics.size > 0 && Math.random() < 0.15) {
        const suggestion = suggestUndiscussedTopic(discussedTopics, bestIntent.category)
        if (suggestion) {
          response += ` ${suggestion}`
        }
      }

      setLastTopic(bestIntent.category)
      return response
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
    if (normalizedMessage.includes('—á—Ç–æ') || normalizedMessage.includes('–∫–∞–∫') || normalizedMessage.includes('–≥–¥–µ')) {
      if (normalizedMessage.includes('–¥–µ–ª–∞–µ—à—å') || normalizedMessage.includes('–∑–∞–Ω–∏–º–∞–µ—à—å—Å—è')) {
        const servicesIntent = INTENTS.find((i) => i.category === 'services')
        if (servicesIntent && typeof servicesIntent.response === 'function') {
          return servicesIntent.response([...conversationContext, normalizedMessage])
        }
        return getDefaultResponse()
      }
      if (normalizedMessage.includes('—Å—Ç–æ–∏—Ç') || normalizedMessage.includes('—Ü–µ–Ω–∞')) {
        const pricingIntent = INTENTS.find((i) => i.category === 'pricing')
        if (pricingIntent && typeof pricingIntent.response === 'function') {
          return pricingIntent.response([...conversationContext, normalizedMessage])
        }
        return getDefaultResponse()
      }
      if (normalizedMessage.includes('—Å–≤—è–∑–∞—Ç—å—Å—è') || normalizedMessage.includes('–∫–æ–Ω—Ç–∞–∫—Ç')) {
        const contactsIntent = INTENTS.find((i) => i.category === 'contacts')
        if (contactsIntent && typeof contactsIntent.response === 'function') {
          return contactsIntent.response([...conversationContext, normalizedMessage])
        }
        return getDefaultResponse()
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–º–æ—â—å
    if (normalizedMessage.includes('–ø–æ–º–æ—â—å') || normalizedMessage.includes('–ø–æ–º–æ–≥–∏') || normalizedMessage.includes('–Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å')) {
      const helpResponses = [
        '–ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–≥—É! üòä –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ:\n‚Ä¢ –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –ø—Ä–æ–µ–∫—Ç–∞—Ö –°–µ—Ä–≥–µ—è\n‚Ä¢ –£—Å–ª—É–≥–∞—Ö –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö\n‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å—Ä–æ–∫–∞—Ö\n‚Ä¢ –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è\n\n–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        '–° —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–≥—É! –°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π. –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –µ–≥–æ —Ä–∞–±–æ—Ç—ã, —É—Å–ª—É–≥–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –ß—Ç–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?',
        '–ü–æ–º–æ–≥—É —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º! –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∏ –∏–ª–∏ –ø–æ–º–æ—á—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º.',
      ]
      return helpResponses[Math.floor(Math.random() * helpResponses.length)]
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –±–æ—Ç–∞/–ø–æ–º–æ—â–Ω–∏–∫–∞
    if (normalizedMessage.includes('—Ç—ã –±–æ—Ç') || normalizedMessage.includes('—Ç—ã –ø–æ–º–æ—â–Ω–∏–∫') || normalizedMessage.includes('—Ç—ã –∫—Ç–æ') || normalizedMessage.includes('–∫—Ç–æ —Ç—ã')) {
      const botResponses = [
        '–Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è, –ø–æ–º–æ–≥–∞—é –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –µ–≥–æ —Ä–∞–±–æ—Ç–µ –∏ —É—Å–ª—É–≥–∞—Ö. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
        '–Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è –ö–∏–±–∞–ª—å–Ω–∏–∫–∞. –ü–æ–º–æ–≥–∞—é —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
        '–Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è. –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ö, —É—Å–ª—É–≥–∞—Ö, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö. –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?',
      ]
      return botResponses[Math.floor(Math.random() * botResponses.length)]
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    if (normalizedMessage.includes('—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç') && !normalizedMessage.includes('—Ä–∞–±–æ—Ç–∞–µ—à—å') && !normalizedMessage.includes('–æ–ø—ã—Ç')) {
      return '–°–µ—Ä–≥–µ–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∏ –∏–∑—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –í–∞–∂–Ω–µ–µ –Ω–µ –≤–æ–∑—Ä–∞—Å—Ç, –∞ –æ–ø—ã—Ç –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã, –ø—Ä–∞–≤–¥–∞? üòä'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
    if (normalizedMessage.includes('–ª—É—á—à–µ —á–µ–º') || normalizedMessage.includes('–æ—Ç–ª–∏—á–∞–µ—à—å—Å—è') || normalizedMessage.includes('–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã')) {
      return '–°–µ—Ä–≥–µ–π —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ –∫ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–µ–∫—Ç—É. –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏, –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏, —Å–æ–±–ª—é–¥–∞–µ—Ç —Å—Ä–æ–∫–∏. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ –µ–≥–æ –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–±–æ—Ç–µ?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≥–∞—Ä–∞–Ω—Ç–∏–∏
    if (normalizedMessage.includes('–≥–∞—Ä–∞–Ω—Ç–∏—è') || normalizedMessage.includes('–≥–∞—Ä–∞–Ω—Ç–∏–∏') || normalizedMessage.includes('–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ')) {
      return '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ‚Äî –ø–ª–∞—Ç–Ω–∞—è. –î–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–∞–≤–∫–∏ ‚Äî –ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏. –î–µ—Ç–∞–ª–∏ –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
    if (normalizedMessage.includes('–±—ã—Å—Ç—Ä–æ') && (normalizedMessage.includes('—Å–¥–µ–ª–∞—Ç—å') || normalizedMessage.includes('–≥–æ—Ç–æ–≤–æ'))) {
      return '–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞. –õ–µ–Ω–¥–∏–Ω–≥ - –∑–∞ –Ω–µ–¥–µ–ª—é, —Å–∞–π—Ç –ø–æ—Å–ª–æ–∂–Ω–µ–µ - 2-3 –Ω–µ–¥–µ–ª–∏. –°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è —É–ª–æ–∂–∏—Ç—å—Å—è –≤ —Å—Ä–æ–∫–∏, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –æ–ø—ã—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
    if (normalizedMessage.includes('–∫–ª–∏–µ–Ω—Ç—ã') || normalizedMessage.includes('–∑–∞–∫–∞–∑—á–∏–∫–∏') || normalizedMessage.includes('—Ä–∞–±–æ—Ç–∞–ª —Å')) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–ª —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ - –æ—Ç —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤ –¥–æ –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π. –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã —Ä–∞–∑–Ω—ã–µ, –∫ –∫–∞–∂–¥–æ–º—É –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏—Ö/–Ω–µ –ø–æ —Ç–µ–º–µ –≤–æ–ø—Ä–æ—Å–æ–≤
    if (normalizedMessage.includes('—Å–º—ã—Å–ª –∂–∏–∑–Ω–∏') || normalizedMessage.includes('–∑–∞—á–µ–º –∂–∏—Ç—å') || normalizedMessage.includes('–≤ —á–µ–º —Å–º—ã—Å–ª')) {
      return '–•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! üòä –ù–æ —è –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —Ç–∞–∫ —á—Ç–æ –ª—É—á—à–µ —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏–ª–∏ —É—Å–ª—É–≥–∏ –°–µ—Ä–≥–µ—è. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —ç—Ç–∏–º!'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –ø–æ–≥–æ–¥—É/–≤—Ä–µ–º—è
    if (normalizedMessage.includes('–ø–æ–≥–æ–¥–∞') || normalizedMessage.includes('–≤—Ä–µ–º—è') && !normalizedMessage.includes('—Å—Ä–æ–∫–∏') && !normalizedMessage.includes('—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏')) {
      return '–Ø –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —Ç–∞–∫ —á—Ç–æ –ª—É—á—à–µ —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏–ª–∏ —É—Å–ª—É–≥–∏ –°–µ—Ä–≥–µ—è. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —ç—Ç–∏–º! üòä'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π/–Ω–µ–≥–∞—Ç–∏–≤–∞ (–≤–µ–∂–ª–∏–≤–æ)
    if (normalizedMessage.includes('—Ç—É–ø–æ–π') || normalizedMessage.includes('–≥–ª—É–ø—ã–π') || normalizedMessage.includes('–ø–ª–æ—Ö–æ–π')) {
      return '–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –º–æ–≥—É –Ω–µ –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ - –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –°–µ—Ä–≥–µ–µ–º –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram @kosmosega, –æ–Ω —Ç–æ—á–Ω–æ –ø–æ–º–æ–∂–µ—Ç! üòä'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –æ–ø–µ—á–∞—Ç–∫–∞–º–∏/—Å–ª–µ–Ω–≥–æ–º
    if (normalizedMessage.includes('—á—ë') || normalizedMessage.includes('—â–∞—Å') || normalizedMessage.includes('—â–∞')) {
      return '–ü–æ–Ω—è–ª —Ç–µ–±—è! üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∏ –∏–ª–∏ –ø–æ–º–æ—á—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
    if (/^[a-z\s]+$/i.test(normalizedMessage.replace(/[^a-z\s]/gi, '')) && normalizedMessage.length > 5) {
      const englishResponses = [
        'I understand English, but I prefer Russian. –°–µ—Ä–≥–µ–π speaks Russian, so it\'s better to ask in Russian. –ú–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º! üòä',
        'I can understand, but let\'s speak Russian. –°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏. –ú–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º!',
      ]
      return englishResponses[Math.floor(Math.random() * englishResponses.length)]
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—É–º–º—ã/—Ü–∏—Ñ—Ä—ã
    if (normalizedMessage.match(/\d+[–∫–∫]/) || normalizedMessage.match(/–æ—Ç \d+/) || normalizedMessage.match(/\d+ —Ç—ã—Å—è—á/)) {
      return '–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏ - —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞, —Ñ—É–Ω–∫—Ü–∏–∏, —Å—Ä–æ–∫–∏. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega, –∏ –°–µ—Ä–≥–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç —Ä–∞—Å—á–µ—Ç.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É/—Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
    if (normalizedMessage.includes('–±–µ—Å–ø–ª–∞—Ç–Ω–æ') || normalizedMessage.includes('—Ç–µ—Å—Ç–æ–≤–æ–µ') || normalizedMessage.includes('–ø—Ä–æ–±–Ω—ã–π')) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–ª–∞—Ç–Ω–æ–π –æ—Å–Ω–æ–≤–µ, –Ω–æ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —É–¥–∞–ª–µ–Ω–∫—É/–æ—Ñ–∏—Å
    if (normalizedMessage.includes('—É–¥–∞–ª–µ–Ω–Ω–æ') || normalizedMessage.includes('–æ—Ñ–∏—Å') || normalizedMessage.includes('–≥–¥–µ —Ä–∞–±–æ—Ç–∞–µ—à—å')) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —É–¥–∞–ª–µ–Ω–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –≤ –ú–æ—Å–∫–≤–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –û—Å–Ω–æ–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ - —á–µ—Ä–µ–∑ Telegram, —ç—Ç–æ —É–¥–æ–±–Ω–µ–µ –≤—Å–µ–≥–æ.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∫–æ–º–∞–Ω–¥—É
    if (normalizedMessage.includes('–∫–æ–º–∞–Ω–¥–∞') || normalizedMessage.includes('–∫–æ–ª–ª–µ–≥–∏') || normalizedMessage.includes('—Ä–∞–±–æ—Ç–∞–µ—à—å –æ–¥–∏–Ω')) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–ª–µ—á—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –û–±—ã—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∞–º —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∑–∞–¥–∞—á.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
    if (normalizedMessage.split('?').length > 1 || normalizedMessage.split('.').length > 3) {
      return handleComplexQuery(normalizedMessage, keywords)
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–∏–ø–∞ "—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ X –∏ Y"
    if (normalizedMessage.includes(' –∏ ') && keywords.length > 3) {
      const andParts = normalizedMessage.split(' –∏ ')
      if (andParts.length >= 2) {
        return handleMultipleTopics(andParts)
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
    if (normalizedMessage.includes('–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç') || normalizedMessage.includes('–∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω')) {
      const tech = extractSpecificTopics(normalizedMessage)
      if (tech.length > 0) {
        return `–≠—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ ${tech[0]}. –°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö. –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega - —Ç–∞–º –æ–Ω —Å–º–æ–∂–µ—Ç –¥–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.`
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –æ–±—É—á–µ–Ω–∏–µ/–∫—É—Ä—Å—ã
    if (normalizedMessage.includes('–æ–±—É—á–∞–µ—à—å') || normalizedMessage.includes('–∫—É—Ä—Å—ã') || normalizedMessage.includes('–Ω–∞—É—á–∏—Ç—å')) {
      return '–°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, –∞ –Ω–µ –æ–±—É—á–µ–Ω–∏–µ–º. –ù–æ –º–æ–∂–µ—Ç –¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º –∏–ª–∏ –ø–æ–º–æ—á—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?'
    }


    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Å—Ä–æ–∫–∏ –æ–ø–ª–∞—Ç—ã
    if (normalizedMessage.includes('–æ–ø–ª–∞—Ç–∞') || normalizedMessage.includes('–∫–∞–∫ –ø–ª–∞—Ç–∏—Ç—å') || normalizedMessage.includes('–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞')) {
      return '–û–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞ –∏–¥–µ—Ç —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π –∏ –ø–æ—ç—Ç–∞–ø–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π –ø–æ —ç—Ç–∞–ø–∞–º. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
    if ((normalizedMessage.includes('–ø–æ–∫–∞–∂–∏ —Ä–∞–±–æ—Ç—ã') || normalizedMessage.includes('–ø—Ä–∏–º–µ—Ä—ã')) && normalizedMessage.includes('–¥—Ä—É–≥–∏—Ö')) {
      return '–Ø –ø–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è, –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ –µ–≥–æ —Ä–∞–±–æ—Ç—ã. –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –æ—Ç–∑—ã–≤—ã
    if (normalizedMessage.includes('–æ—Ç–∑—ã–≤—ã') || normalizedMessage.includes('—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏') || normalizedMessage.includes('—á—Ç–æ –≥–æ–≤–æ—Ä—è—Ç')) {
      return '–£ –°–µ—Ä–≥–µ—è –µ—Å—Ç—å –¥–æ–≤–æ–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. –õ—É—á—à–µ –≤—Å–µ–≥–æ - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –æ–±—Å—É–¥–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –¥–∏–∑–∞–π–Ω
    if (normalizedMessage.includes('–¥–∏–∑–∞–π–Ω') && !normalizedMessage.includes('–¥–µ–ª–∞–µ—à—å')) {
      return '–°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å –≥–æ—Ç–æ–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º, —Ç–∞–∫ –∏ –ø–æ–º–æ—á—å —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–∏–∑–∞–π–Ω–∞. –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∑–∞–π–Ω - –æ—Ç–ª–∏—á–Ω–æ, –µ—Å–ª–∏ –Ω–µ—Ç - –º–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –¥–æ–º–µ–Ω/—Ö–æ—Å—Ç–∏–Ω–≥
    if (normalizedMessage.includes('–¥–æ–º–µ–Ω') || normalizedMessage.includes('—Ö–æ—Å—Ç–∏–Ω–≥') || normalizedMessage.includes('–≥–¥–µ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å')) {
      return '–°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–æ–º–µ–Ω–∞. –û–±—ã—á–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –Ω–∞–¥–µ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. –î–µ—Ç–∞–ª–∏ –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ SEO
    if (normalizedMessage.includes('seo') || normalizedMessage.includes('–ø–æ–∏—Å–∫–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è') || normalizedMessage.includes('–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ')) {
      return '–°–µ—Ä–≥–µ–π –¥–µ–ª–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å –¥–ª—è SEO - –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –º–µ—Ç–∞-—Ç–µ–≥–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ó–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞—Ö –æ–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã. –ù–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –±–∞–∑—É –¥–ª—è SEO –°–µ—Ä–≥–µ–π –¥–µ–ª–∞–µ—Ç.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
    if (normalizedMessage.includes('–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è') || normalizedMessage.includes('–∞–¥–∞–ø—Ç–∏–≤') || normalizedMessage.includes('—Ç–µ–ª–µ—Ñ–æ–Ω')) {
      return '–ö–æ–Ω–µ—á–Ω–æ! –í—Å–µ —Å–∞–π—Ç—ã –°–µ—Ä–≥–µ—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Å—Ä–æ–∫–∏ –¥–æ—Ä–∞–±–æ—Ç–æ–∫
    if (normalizedMessage.includes('–¥–æ—Ä–∞–±–æ—Ç–∫–∏') || normalizedMessage.includes('–∏–∑–º–µ–Ω–µ–Ω–∏—è') && normalizedMessage.includes('–ø–æ—Å–ª–µ')) {
      return '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ‚Äî –ø–ª–∞—Ç–Ω–∞—è. –î–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–∞–≤–∫–∏ ‚Äî –ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏. –î–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≤–µ—Ä—Å–∏–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
    if (normalizedMessage.includes('–≤–µ—Ä—Å–∏—è') && (normalizedMessage.includes('react') || normalizedMessage.includes('node') || normalizedMessage.includes('next'))) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π. React 19, Next.js 15, Node.js –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π. –í—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    if (normalizedMessage.includes('–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å') || normalizedMessage.includes('–∑–∞—â–∏—Ç–∞') || normalizedMessage.includes('—Ö–∞–∫–µ—Ä—ã')) {
      return '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å –ª—é–±–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –°–µ—Ä–≥–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∑–∞—â–∏—Ç—É –æ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, HTTPS, –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –¥–µ–ª–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    if (normalizedMessage.includes('–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö') || normalizedMessage.includes('–±–¥') || normalizedMessage.includes('–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏—Ç—å')) {
      return '–°–µ—Ä–≥–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL –∏ MongoDB - –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –ú–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ API
    if (normalizedMessage.includes('api') || normalizedMessage.includes('–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è') || normalizedMessage.includes('–ø–æ–¥–∫–ª—é—á–∏—Ç—å')) {
      return '–°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å REST API, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏, —Å–æ—Ü—Å–µ—Ç–∏ –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    if (normalizedMessage.includes('—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ') || normalizedMessage.includes('—Ç–µ—Å—Ç—ã') || normalizedMessage.includes('–ø—Ä–æ–≤–µ—Ä–∫–∞')) {
      return '–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º. –°–µ—Ä–≥–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –±—Ä–∞—É–∑–µ—Ä–∞—Ö, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –ö–∞—á–µ—Å—Ç–≤–æ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    if ((normalizedMessage.includes('–±—ã—Å—Ç—Ä–æ') && normalizedMessage.includes('—Ä–∞–±–æ—Ç–∞–µ—Ç')) || normalizedMessage.includes('–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å') || normalizedMessage.includes('—Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏')) {
      return '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å. –°–µ—Ä–≥–µ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é. –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–ª–∞–≤–Ω–æ.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
    if (normalizedMessage.includes('–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥') || (normalizedMessage.includes('–∫–æ–¥') && normalizedMessage.includes('–æ—Ç–¥–∞—Ç—å')) || normalizedMessage.includes('git')) {
      return '–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –°–µ—Ä–≥–µ–π –ø–µ—Ä–µ–¥–∞–µ—Ç –≤–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç—É. –û–±—ã—á–Ω–æ –∫–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É. –í—Å–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
    if (normalizedMessage.includes('–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å') || normalizedMessage.includes('—Å–µ–∫—Ä–µ—Ç–Ω–æ') || normalizedMessage.includes('–Ω–µ —Ä–∞–∑–≥–ª–∞—à–∞—Ç—å')) {
      return '–ö–æ–Ω–µ—á–Ω–æ, –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö —Å—Ç—Ä–æ–≥–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã. –°–µ—Ä–≥–µ–π —Å–æ–±–ª—é–¥–∞–µ—Ç NDA, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Å—Ä–æ—á–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
    if (normalizedMessage.includes('—Å—Ä–æ—á–Ω–æ') || normalizedMessage.includes('–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ') || normalizedMessage.includes('–≥–æ—Ä—è—â–∏–π')) {
      return '–°—Ä–æ—á–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –≤–æ–∑–º–æ–∂–Ω—ã, –Ω–æ —Å—Ä–æ–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –õ–µ–Ω–¥–∏–Ω–≥ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –¥–æ–ª—å—à–µ. –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —á–∞—Å—Ç–∏—á–Ω—É—é –æ–ø–ª–∞—Ç—É
    if (normalizedMessage.includes('—Ä–∞—Å—Å—Ä–æ—á–∫–∞') || normalizedMessage.includes('—á–∞—Å—Ç—è–º–∏') || normalizedMessage.includes('–ø–æ—ç—Ç–∞–ø–Ω–æ')) {
      return '–î–∞, –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –ø–æ—ç—Ç–∞–ø–Ω—É—é –æ–ø–ª–∞—Ç—É - –ø–æ —ç—Ç–∞–ø–∞–º —Ä–∞–±–æ—Ç—ã. –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –î–µ—Ç–∞–ª–∏ –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
    if (normalizedMessage.includes('—Å—Ç–∞—Ä—ã–π') && (normalizedMessage.includes('–∫–æ–¥') || normalizedMessage.includes('—Å–∞–π—Ç') || normalizedMessage.includes('–ø—Ä–æ–µ–∫—Ç'))) {
      return '–°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Å –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–µ–π —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ - –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —É–ª—É—á—à–∏—Ç—å –∫–æ–¥, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
    if (normalizedMessage.includes('–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è') && normalizedMessage.includes('–±–µ—Å–ø–ª–∞—Ç–Ω')) {
      return '–°–µ—Ä–≥–µ–π –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –æ–±—ã—á–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è. –ù–∞–ø–∏—à–∏ –≤ Telegram @kosmosega, –æ–±—Å—É–¥–∏–º!'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —ç–º–æ–¥–∑–∏/—Å–º–∞–π–ª–∏–∫–∏ (–ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, —ç–º–æ–¥–∑–∏ –Ω–µ –º–µ—à–∞—é—Ç)
    // –≠–º–æ–¥–∑–∏ —É–∂–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç–∞–∫ —á—Ç–æ —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    if (normalizedMessage.length < 3 && normalizedMessage !== '–¥–∞' && normalizedMessage !== '–Ω–µ—Ç' && normalizedMessage !== '–æ–∫') {
      return '–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ú–æ–∂–µ—à—å —É—Ç–æ—á–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å? –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —É—Å–ª—É–≥–∞–º–∏ –∏–ª–∏ —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º.'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –≤–æ–ø—Ä–æ—Å–æ–≤
    if (conversationContext.length > 0 && conversationContext[conversationContext.length - 1] === normalizedMessage) {
      return '–¢—ã —É–∂–µ —Å–ø—Ä–∞—à–∏–≤–∞–ª –æ–± —ç—Ç–æ–º. –ú–æ–∂–µ—Ç, —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å —á—Ç–æ-—Ç–æ –µ—â–µ? –ò–ª–∏ –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega?'
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ "–ø–æ—á–µ–º—É"
    if (normalizedMessage.startsWith('–ø–æ—á–µ–º—É') || normalizedMessage.startsWith('–∑–∞—á–µ–º')) {
      const whyResponses = [
        '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –µ—Å–ª–∏ —É—Ç–æ—á–Ω–∏—à—å, –æ —á–µ–º –∏–º–µ–Ω–Ω–æ —Ä–µ—á—å.',
        '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ —Å–ø—Ä–æ—Å–∏–ª! –≠—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –•–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª—É—á–∞–π?',
        '–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –µ—Å–ª–∏ —Ä–∞—Å—Å–∫–∞–∂–µ—à—å, –æ —á–µ–º –∏–º–µ–Ω–Ω–æ –∏–¥–µ—Ç —Ä–µ—á—å.',
      ]
      return whyResponses[Math.floor(Math.random() * whyResponses.length)]
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ "–º–æ–∂–Ω–æ –ª–∏"
    if (normalizedMessage.startsWith('–º–æ–∂–Ω–æ') || normalizedMessage.startsWith('–º–æ–∂–Ω–æ –ª–∏')) {
      return '–ú–Ω–æ–≥–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ! –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ, –∏ —è —Å–∫–∞–∂—É, –º–æ–∂–µ—Ç –ª–∏ –°–µ—Ä–≥–µ–π –ø–æ–º–æ—á—å. –ò–ª–∏ –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega?'
    }

    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const contextHint = getContextualHint(conversationContext)
    const defaultResponse = getDefaultResponse()
    return defaultResponse + (contextHint ? ' ' + contextHint : '')
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const getCategoryHint = (category: string): string => {
    const hints: Record<string, string> = {
      portfolio: '–¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏–∑ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ',
      services: '–¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥–∞—Ö',
      skills: '–¥—Ä—É–≥–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö',
      pricing: '–¥–µ—Ç–∞–ª—è—Ö —Å—Ç–æ–∏–º–æ—Å—Ç–∏',
      contacts: '–¥—Ä—É–≥–∏—Ö —Å–ø–æ—Å–æ–±–∞—Ö —Å–≤—è–∑–∏',
    }
    return hints[category] || '—ç—Ç–æ–º'
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  const handleFollowUpQuestion = (question: string, lastCategory: string): string | null => {
    const lowerQuestion = normalizeText(question)
    
    // –£—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
    if (lastCategory === 'portfolio') {
      if (lowerQuestion.includes('–∫–∞–∫–æ–π') || lowerQuestion.includes('–∫–∞–∫–∏–µ')) {
        return '–°–µ—Ä–≥–µ–π –¥–µ–ª–∞–ª —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã - –∏ –ø—Ä–æ—Å—Ç—ã–µ –ª–µ–Ω–¥–∏–Ω–≥–∏, –∏ —Å–ª–æ–∂–Ω—ã–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ï—Å—Ç—å —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å.'
      }
      if (lowerQuestion.includes('–≥–¥–µ') || lowerQuestion.includes('–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å')) {
        return '–ü—Ä–æ–µ–∫—Ç—ã –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –Ω–∞ —Å–∞–π—Ç–µ –∏–ª–∏ –Ω–∞ GitHub. –•–æ—á–µ—à—å, —Ä–∞—Å—Å–∫–∞–∂—É –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ?'
      }
      if (lowerQuestion.includes('—Å–∫–æ–ª—å–∫–æ') || lowerQuestion.includes('–º–Ω–æ–≥–æ')) {
        return '–£ –°–µ—Ä–≥–µ—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Ä–∞–∑–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –û—Ç –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?'
      }
    }
    
    // –£—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ —É—Å–ª—É–≥–∞–º
    if (lastCategory === 'services') {
      if (lowerQuestion.includes('–º–æ–∂–Ω–æ') || lowerQuestion.includes('–º–æ–∂–µ—à—å')) {
        return '–°–µ—Ä–≥–µ–π –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π —Å–∞–π—Ç–∞ –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –∫–ª—é—á. –û—Ç –¥–∏–∑–∞–π–Ω–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?'
      }
      if (lowerQuestion.includes('–∫–∞–∫') || lowerQuestion.includes('–∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º')) {
        return '–û–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞ –∏–¥–µ—Ç —Ç–∞–∫: –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –æ—Ü–µ–Ω–∫–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–ø—É—Å–∫. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –∫–∞–∫–æ–π-—Ç–æ —ç—Ç–∞–ø?'
      }
    }
    
    // –£—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    if (lastCategory === 'pricing') {
      if (lowerQuestion.includes('–ø—Ä–∏–º–µ—Ä–Ω–æ') || lowerQuestion.includes('–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ')) {
        return '–ü—Ä–∏–º–µ—Ä–Ω–æ: –ª–µ–Ω–¥–∏–Ω–≥ –æ—Ç 10–∫, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç –æ—Ç 30-50–∫, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç 100–∫. –ù–æ —Ç–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–µ—Ç–∞–ª–µ–π. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.'
      }
      if (lowerQuestion.includes('–¥–µ—à–µ–≤–ª–µ') || lowerQuestion.includes('—Å–∫–∏–¥–∫–∞')) {
        return '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä–µ–º–∞ —Ä–∞–±–æ—Ç—ã. –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –±–æ–ª—å—à–æ–π, –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –ø–æ—ç—Ç–∞–ø–Ω—É—é –æ–ø–ª–∞—Ç—É. –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.'
      }
    }
    
    return null
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
  const handleComparison = (items: string[]): string => {
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
    if (items.some(i => i.includes('react')) && items.some(i => i.includes('vue') || i.includes('angular'))) {
      return '–°–µ—Ä–≥–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ React - —ç—Ç–æ –µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. React –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –∏ –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ. –ù–æ –≤—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ React?'
    }
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
    if (items.some(i => i.includes('–ª–µ–Ω–¥–∏–Ω–≥')) && items.some(i => i.includes('—Å–∞–π—Ç') || i.includes('–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'))) {
      return '–õ–µ–Ω–¥–∏–Ω–≥ - –ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–º–æ. –°–∞–π—Ç –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–µ–µ. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ü–µ–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ?'
    }
    
    return '–û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–º–µ—é—Ç —Å–≤–æ–∏ –ø–ª—é—Å—ã. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega, –∏ –°–µ—Ä–≥–µ–π –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.'
  }

  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
  const adaptToNegativeSentiment = (response: string, category: string): string => {
    if (category === 'pricing') {
      return response.replace(/—Å—Ç–æ–∏–º–æ—Å—Ç—å|—Ü–µ–Ω–∞/gi, (match) => {
        return match + '. –ü–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ç–æ –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å - –¥–∞–≤–∞–π –æ–±—Å—É–¥–∏–º –≤–∞—Ä–∏–∞–Ω—Ç—ã'
      })
    }
    return response + ' –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–º–Ω–µ–Ω–∏—è –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã - –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –≤ Telegram @kosmosega.'
  }

  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
  const adaptToPositiveSentiment = (response: string): string => {
    const positiveAdditions = [
      ' –û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—à—å—Å—è!',
      ' –ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ —Å–ø—Ä–æ—Å–∏–ª!',
      ' –†–∞–¥, —á—Ç–æ —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ!',
    ]
    if (Math.random() < 0.3) {
      return response + positiveAdditions[Math.floor(Math.random() * positiveAdditions.length)]
    }
    return response
  }

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ follow-up –≤–æ–ø—Ä–æ—Å—ã
  const getContextualFollowUp = (category: string, discussedTopics: Set<string>, context: string[]): string | null => {
    // –ï—Å–ª–∏ —É–∂–µ –æ–±—Å—É–∂–¥–∞–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
    if (category === 'skills' && discussedTopics.size > 0) {
      const techs = Array.from(discussedTopics).filter(t => ['react', 'node', 'typescript', 'next'].includes(t))
      if (techs.length > 0) {
        return `–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å, –∫–∞–∫ ${techs[0]} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –°–µ—Ä–≥–µ—è?`
      }
    }
    
    // –ï—Å–ª–∏ –æ–±—Å—É–∂–¥–∞–ª–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
    if (category === 'portfolio' && context.length > 1) {
      return '–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –ø–æ–¥—Ä–æ–±–Ω–µ–µ?'
    }
    
    // –ï—Å–ª–∏ –æ–±—Å—É–∂–¥–∞–ª–∏ —É—Å–ª—É–≥–∏, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
    if (category === 'services' && !discussedTopics.has('project')) {
      return '–ï—Å—Ç—å –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å?'
    }
    
    return null
  }

  // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–æ–±—Å—É–∂–¥–µ–Ω–Ω—ã—Ö —Ç–µ–º
  const suggestUndiscussedTopic = (discussed: Set<string>, currentCategory: string): string | null => {
    const allCategories = ['portfolio', 'services', 'skills', 'pricing', 'contacts', 'work', 'experience']
    const undiscussed = allCategories.filter(cat => cat !== currentCategory && !discussed.has(cat))
    
    if (undiscussed.length > 0 && Math.random() < 0.3) {
      const topic = undiscussed[Math.floor(Math.random() * undiscussed.length)]
      const suggestions: Record<string, string> = {
        portfolio: '–ö—Å—Ç–∞—Ç–∏, –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –°–µ—Ä–≥–µ—è, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.',
        services: '–ú–æ–≥—É —Ç–∞–∫–∂–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —É—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –°–µ—Ä–≥–µ–π.',
        skills: '–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –Ω–∞–≤—ã–∫–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–µ—Ä–≥–µ–π?',
        pricing: '–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å - –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —ç—Ç–æ.',
        contacts: '–ù—É–∂–Ω—ã –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏?',
        work: '–°–µ—Ä–≥–µ–π –æ—Ç–∫—Ä—ã—Ç –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.',
      }
      return suggestions[topic] || null
    }
    
    return null
  }

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
  const getContextualHint = (context: string[]): string | null => {
    if (context.length === 0) return null

    const categories = context.map((msg) => {
      const scores = INTENTS.map((intent) => ({
        category: intent.category,
        score: calculateRelevance(intent, msg, extractKeywords(msg)),
      }))
      return scores.sort((a, b) => b.score - a.score)[0]?.category
    })

    const mostCommonCategory = categories
      .filter((c) => c)
      .reduce((acc, cat) => {
        acc[cat!] = (acc[cat!] || 0) + 1
        return acc
      }, {} as Record<string, number>)

    const topCategory = Object.entries(mostCommonCategory).sort((a, b) => b[1] - a[1])[0]?.[0]

    if (topCategory && topCategory !== 'greeting') {
      const suggestions: Record<string, string> = {
        portfolio: '–ú–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –°–µ—Ä–≥–µ—è –∏–ª–∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª.',
        services: '–ú–æ–≥—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ª—é–±–æ–π –∏–∑ —É—Å–ª—É–≥ –°–µ—Ä–≥–µ—è –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç.',
        skills: '–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –°–µ—Ä–≥–µ—è.',
        pricing: '–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –Ω—É–∂–Ω—ã –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram!',
      }
      return suggestions[topCategory] || null
    }

    return null
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  const handleComplexQuery = (message: string, keywords: string[]): string => {
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    const detectedIntents: string[] = []
    
    INTENTS.forEach(intent => {
      const score = calculateRelevance(intent, message, keywords)
      if (score > 0) {
        detectedIntents.push(intent.category)
      }
    })
    
    if (detectedIntents.length > 1) {
      const responses: Record<string, string> = {
        'portfolio,services': '–û—Ç–ª–∏—á–Ω–æ! –£ –°–µ—Ä–≥–µ—è –µ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏, –∏ –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É—Å–ª—É–≥–∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–±–æ—Ç—ã –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç?',
        'services,pricing': '–°–µ—Ä–≥–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞. –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤ Telegram @kosmosega.',
        'portfolio,skills': '–£ –°–µ—Ä–≥–µ—è –µ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–¥–µ–ª–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π - React, Next.js, Node.js –∏ –¥—Ä—É–≥–∏—Ö. –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç—ã?',
      }
      
      const key = detectedIntents.slice(0, 2).sort().join(',')
      if (responses[key]) {
        return responses[key]
      }
      
      return `–ü–æ–Ω—è–ª, —É —Ç–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤. ${detectedIntents.map(cat => {
        const intent = INTENTS.find(i => i.category === cat)
        return intent ? `–ü—Ä–æ ${getCategoryHint(cat)}` : ''
      }).filter(Boolean).join(' –∏ ')}. –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ - —á—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`
    }
    
    return getDefaultResponse()
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–µ–º–∞–º–∏
  const handleMultipleTopics = (parts: string[]): string => {
    const topics: string[] = []
    
    parts.forEach(part => {
      const normalized = normalizeText(part)
      const scores = INTENTS.map(intent => ({
        category: intent.category,
        score: calculateRelevance(intent, normalized, extractKeywords(part)),
      }))
      scores.sort((a, b) => b.score - a.score)
      if (scores[0].score > 0) {
        topics.push(scores[0].category)
      }
    })
    
    if (topics.length >= 2) {
      return `–•–æ—Ä–æ—à–æ, —É —Ç–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤. –ü—Ä–æ ${topics.map(t => getCategoryHint(t)).join(' –∏ ')}. –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ - —á—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? –ò–ª–∏ –º–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤—Å—ë –ø–æ–¥—Ä–æ–±–Ω–æ –≤ Telegram @kosmosega.`
    }
    
    return getDefaultResponse()
  }

  const handleSendMessage = async (textOverride?: string) => {
    const text = (textOverride ?? inputValue).trim()
    if (!text) return

    const userMessage: Message = {
      id: Date.now().toString(),
      text,
      sender: 'user',
      timestamp: new Date(),
    }

    setMessages((prev) => [...prev, userMessage])
    const messageText = text
    if (!textOverride) setInputValue('')
    setIsTyping(true)

    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    // try {
    //   const apiUrl = process.env.NEXT_PUBLIC_TELEGRAM_API_URL || '/api/contact'
    //   await fetch(apiUrl, {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/json' },
    //     body: JSON.stringify({
    //       name: '–ß–∞—Ç-–±–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    //       contact: 'chat-widget',
    //       message: `–°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞: ${messageText}`,
    //     }),
    //   })
    // } catch (error) {
    //   console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', error)
    // }

    // –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ –ø–µ—á–∞—Ç–∞–µ—Ç)
    // –ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–∞
    const responseText = getBotResponse(messageText)
    const typingDelay = Math.min(
      Math.max(500, responseText.length * 30), // –ú–∏–Ω–∏–º—É–º 500–º—Å, –ø—Ä–∏–º–µ—Ä–Ω–æ 30–º—Å –Ω–∞ —Å–∏–º–≤–æ–ª
      3000 // –ú–∞–∫—Å–∏–º—É–º 3 —Å–µ–∫—É–Ω–¥—ã
    )
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –≤–∞—Ä–∏–∞—Ü–∏—é –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    const finalDelay = typingDelay + (Math.random() * 500 - 250) // ¬±250–º—Å
    
    setTimeout(() => {
      const botResponse: Message = {
        id: (Date.now() + 1).toString(),
        text: responseText,
        sender: 'bot',
        timestamp: new Date(),
      }
      setMessages((prev) => [...prev, botResponse])
      setIsTyping(false)
    }, finalDelay)
  }

  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault()
      handleSendMessage()
    }
  }

  return (
    <>
      {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ */}
      {!isOpen && (
        <button
          onClick={() => setIsOpen(true)}
          className="chat-widget-trigger fixed bottom-6 right-6 z-50 bg-white dark:bg-[#2A2A2A] rounded-full p-2 shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 flex items-center justify-center w-14 h-14 border-2 border-[var(--accent-purple)] hover:border-[var(--accent-purple-light)]"
          aria-label="–û—Ç–∫—Ä—ã—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–∞"
        >
          <Image
            src="/assets/favicon.svg"
            alt=""
            className="w-9 h-9"
            width={36}
            height={36}
          />
        </button>
      )}

      {/* –û–∫–Ω–æ —á–∞—Ç–∞ */}
      {isOpen && (
        <div className="fixed bottom-6 right-6 z-50 w-96 max-w-[calc(100vw-3rem)] bg-white dark:bg-[#2A2A2A] rounded-2xl shadow-2xl flex flex-col h-[600px] max-h-[calc(100vh-8rem)] border border-gray-200 dark:border-[#404040]">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="bg-gradient-to-r from-[var(--accent-purple)] to-[var(--accent-purple-light)] text-white p-4 rounded-t-2xl flex items-center justify-between gap-2">
            <div className="flex items-center gap-3 min-w-0 flex-1">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center overflow-hidden shrink-0">
                <Image src="/assets/favicon.svg" alt="" className="w-7 h-7" width={28} height={28} />
              </div>
              <div className="min-w-0">
                <h3 className="font-semibold text-lg truncate">–ü–æ–º–æ—â–Ω–∏–∫ –°–µ—Ä–≥–µ—è</h3>
                <a
                  href="https://t.me/kosmosega"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-xs opacity-90 hover:opacity-100 flex items-center gap-1 w-fit"
                >
                  <svg className="w-3.5 h-3.5 shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                  </svg>
                  –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram
                </a>
              </div>
            </div>
            <button
              onClick={() => setIsOpen(false)}
              className="hover:bg-white/20 rounded-full p-1 transition-colors"
              aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–∞"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          {/* –°–æ–æ–±—â–µ–Ω–∏—è */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-[#1A1A1A]">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] rounded-2xl px-4 py-2 ${
                    message.sender === 'user'
                      ? 'bg-accent-purple text-white rounded-br-sm'
                      : 'bg-white dark:bg-[#2A2A2A] text-gray-800 dark:text-[#F5F5F5] rounded-bl-sm shadow-sm border border-gray-200 dark:border-[#404040]'
                  }`}
                >
                  <p className="text-sm whitespace-pre-wrap break-words">{message.text}</p>
                  <p
                    className={`text-xs mt-1 ${
                      message.sender === 'user' ? 'text-white/70' : 'text-gray-500 dark:text-[#B0B0B0]'
                    }`}
                  >
                    {message.timestamp.toLocaleTimeString('ru-RU', {
                      hour: '2-digit',
                      minute: '2-digit',
                    })}
                  </p>
                </div>
              </div>
            ))}

            {isTyping && (
              <div className="flex justify-start">
                <div className="bg-white dark:bg-[#2A2A2A] text-gray-800 dark:text-[#F5F5F5] rounded-2xl rounded-bl-sm shadow-sm border border-gray-200 dark:border-[#404040] px-4 py-2">
                  <div className="flex gap-1">
                    <span className="w-2 h-2 bg-gray-400 dark:bg-[#666666] rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></span>
                    <span className="w-2 h-2 bg-gray-400 dark:bg-[#666666] rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></span>
                    <span className="w-2 h-2 bg-gray-400 dark:bg-[#666666] rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></span>
                  </div>
                </div>
              </div>
            )}

            <div ref={messagesEndRef} />
          </div>

          {/* –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã */}
          {messages.length === 1 && (
            <div className="px-4 py-3 bg-white dark:bg-[#2A2A2A] border-t border-gray-200 dark:border-[#404040] space-y-2">
              <div className="flex flex-wrap gap-2">
                {['–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ', '–£—Å–ª—É–≥–∏', '–°—Ç–æ–∏–º–æ—Å—Ç—å', '–ö–æ–Ω—Ç–∞–∫—Ç—ã'].map((quickReply) => (
                  <button
                    key={quickReply}
                    onClick={() => handleSendMessage(quickReply)}
                    type="button"
                    className="text-xs px-3 py-1.5 bg-gray-100 dark:bg-[#333333] hover:bg-[var(--accent-purple)] hover:text-white dark:hover:bg-[var(--accent-purple)] text-gray-700 dark:text-[#F5F5F5] rounded-full transition-colors"
                  >
                    {quickReply}
                  </button>
                ))}
              </div>
              <a
                href="https://t.me/kosmosega"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-1.5 text-xs text-[var(--accent-purple)] hover:underline"
              >
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
                –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram
              </a>
            </div>
          )}

          {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */}
          <div className="p-4 bg-white dark:bg-[#2A2A2A] border-t border-gray-200 dark:border-[#404040] rounded-b-2xl">
            <div className="flex gap-2">
              <input
                ref={inputRef}
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                className="flex-1 px-4 py-2 border border-gray-300 dark:border-[#404040] dark:bg-[#1A1A1A] dark:text-[#F5F5F5] rounded-full focus:outline-none focus:ring-2 focus:ring-accent-purple focus:border-transparent"
              />
              <button
                onClick={() => handleSendMessage()}
                disabled={!inputValue.trim()}
                className="bg-accent-purple hover:bg-accent-purple-light disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-full p-2 transition-colors"
                aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
            <p className="text-xs text-gray-500 dark:text-[#B0B0B0] mt-2 text-center">
              –ò–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å –Ω–∞–ø—Ä—è–º—É—é:{' '}
              <a
                href="https://t.me/kosmosega"
                target="_blank"
                rel="noopener noreferrer"
                className="text-accent-purple hover:underline"
              >
                Telegram @kosmosega
              </a>
            </p>
          </div>
        </div>
      )}
    </>
  )
}

